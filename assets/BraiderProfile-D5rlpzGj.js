import{r as d,g as $,a as x,j as e}from"./index-CNTKhhD_.js";import{g as k}from"./bookingStorage-Bg6UAM2l.js";import{c as T}from"./timeSlots-qFR2TWJe.js";import{t as o}from"./toast-6IGnTReI.js";const L=()=>{const[n,g]=d.useState([]),[y,A]=d.useState([]),[r,f]=d.useState("all"),[P,S]=d.useState(!0),s=$();d.useEffect(()=>{h()},[]),d.useEffect(()=>{U()},[n,r]);const h=async()=>{var t;try{S(!0);const c=(await x.getAll()).appointments||[],j=(t=s==null?void 0:s.braiderId)==null?void 0:t.toString(),u=(s==null?void 0:s._id)||(s==null?void 0:s.id),N=c.filter(a=>{var I,w;const m=(I=a.braiderId)==null?void 0:I.toString();if(j&&m&&m===j)return!0;const p=((w=a.employeeId)==null?void 0:w._id)||a.employeeId;return!!(p&&u&&p.toString()===u.toString()||a.braiderName&&(s!=null&&s.name)&&a.braiderName===s.name)}).map(a=>({id:a._id,braiderId:a.braiderId,braiderName:a.braiderName,date:a.date,timeSlot:a.timeSlot,customerName:a.customerName,customerEmail:a.customerEmail,customerPhone:a.customerPhone,status:a.status,serviceName:a.serviceName,servicePrice:a.servicePrice})).sort((a,m)=>{const p=a.date.localeCompare(m.date);return p!==0?p:a.timeSlot.localeCompare(m.timeSlot)});g(N)}catch{try{const u=k().filter(l=>l.braiderName===(s==null?void 0:s.name)||l.braiderId===E(s==null?void 0:s.name)).sort((l,v)=>{const N=l.date.localeCompare(v.date);return N!==0?N:l.timeSlot.localeCompare(v.timeSlot)});g(u)}catch{}}finally{S(!1)}},E=t=>({Amina:"1",Fatou:"2",Mariama:"3",Aissatou:"4"})[t]||null,U=()=>{const t=new Date().toISOString().split("T")[0];let i=n;r==="upcoming"?i=n.filter(c=>c.date>=t):r==="past"&&(i=n.filter(c=>c.date<t)),A(i)},C=()=>{const t=new Date().toISOString().split("T")[0];return n.filter(i=>i.date>=t).length},b=()=>{const t=new Date().toISOString().split("T")[0];return n.filter(i=>i.date<t||i.status==="completed").length},D=async(t,i)=>{try{await x.updateStatus(t,i),await h(),o.success(`Appointment marked as ${i}`)}catch{o.error("Failed to update appointment status. Please try again.")}},F=async t=>{try{await x.updateStatus(t,"confirmed"),await h(),o.success("Appointment confirmed successfully!")}catch{o.error("Failed to confirm appointment. Please try again.")}},B=async t=>{if(window.confirm("Are you sure you want to cancel this appointment?"))try{await x.cancel(t),await h(),o.success("Appointment cancelled successfully")}catch{o.error("Failed to cancel appointment. Please try again.")}};return P?e.jsx("div",{className:"braider-profile",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"loading",children:"Loading your appointments..."})})}):e.jsx("div",{className:"braider-profile",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{className:"page-title",children:"Braider Dashboard"}),e.jsxs("p",{className:"welcome-text",children:["Welcome back, ",e.jsx("strong",{children:s==null?void 0:s.name}),"!"]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:n.length}),e.jsx("div",{className:"stat-label",children:"Total Appointments"})]}),e.jsxs("div",{className:"stat-card upcoming-stat",children:[e.jsx("div",{className:"stat-value",children:C()}),e.jsx("div",{className:"stat-label",children:"Upcoming"})]}),e.jsxs("div",{className:"stat-card past-stat",children:[e.jsx("div",{className:"stat-value",children:b()}),e.jsx("div",{className:"stat-label",children:"Completed"})]})]})]}),e.jsxs("div",{className:"filter-tabs",children:[e.jsxs("button",{className:`filter-tab ${r==="all"?"active":""}`,onClick:()=>f("all"),children:["All (",n.length,")"]}),e.jsxs("button",{className:`filter-tab ${r==="upcoming"?"active":""}`,onClick:()=>f("upcoming"),children:["Upcoming (",C(),")"]}),e.jsxs("button",{className:`filter-tab ${r==="past"?"active":""}`,onClick:()=>f("past"),children:["Past (",b(),")"]})]}),y.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“…"}),e.jsx("h2",{children:"No appointments found"}),e.jsx("p",{children:r==="upcoming"?"You don't have any upcoming appointments.":r==="past"?"You don't have any past appointments.":"You don't have any appointments yet."})]}):e.jsx("div",{className:"bookings-list",children:y.map(t=>{const i=t.date>=new Date().toISOString().split("T")[0];return e.jsxs("div",{className:`booking-item ${i?"upcoming":"past"}`,children:[e.jsxs("div",{className:"booking-item-header",children:[e.jsx("div",{className:"booking-status-badge",children:i?"ðŸ“… Upcoming":"âœ… Completed"}),e.jsxs("div",{className:"booking-date-time",children:[e.jsx("span",{className:"date",children:T(t.date)}),e.jsx("span",{className:"time",children:t.timeSlot})]})]}),e.jsxs("div",{className:"booking-client-info",children:[e.jsx("h3",{className:"client-name",children:t.customerName}),e.jsxs("div",{className:"client-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“§"}),e.jsx("span",{className:"detail-text",children:t.customerEmail})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“ž"}),e.jsx("span",{className:"detail-text",children:t.customerPhone})]})]})]}),e.jsxs("div",{className:"booking-service-info",children:[e.jsxs("div",{className:"service-badge",children:[e.jsx("span",{className:"service-icon",children:"âœ¨"}),e.jsx("span",{children:t.serviceName||"Hair Braiding Service"})]}),t.status&&e.jsx("div",{className:`status-badge status-${t.status}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),t.status==="pending"&&e.jsxs("div",{className:"booking-actions",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>F(t.id),children:"Confirm Appointment"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>B(t.id),children:"Cancel"})]}),t.status==="confirmed"&&e.jsxs("div",{className:"booking-actions",children:[e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>D(t.id,"completed"),children:"Mark as Completed"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>B(t.id),children:"Cancel"})]})]},t.id)})})]})})};export{L as default};
