import{r as p,g as D,a as x,j as e}from"./index-Kok3V0jD.js";import{g as M}from"./bookingStorage-DA0viRQB.js";import{c as k}from"./timeSlots-qFR2TWJe.js";const Y=()=>{const[r,j]=p.useState([]),[v,w]=p.useState([]),[l,f]=p.useState("all"),[P,y]=p.useState(!0),a=D();p.useEffect(()=>{u()},[]),p.useEffect(()=>{A()},[r,l]);const u=async()=>{var t;try{y(!0);const n=(await x.getAll()).appointments||[],h=(t=a==null?void 0:a.braiderId)==null?void 0:t.toString(),o=(a==null?void 0:a._id)||(a==null?void 0:a.id);console.log("BraiderProfile - Filtering appointments:",{userBraiderId:h,userId:o,userName:a==null?void 0:a.name,totalBookings:n.length});const c=n.filter(i=>{var B,I;const d=(B=i.braiderId)==null?void 0:B.toString();if(h&&d&&d===h)return console.log("Matched by braiderId:",d,"===",h),!0;const m=((I=i.employeeId)==null?void 0:I._id)||i.employeeId;return m&&o&&m.toString()===o.toString()?(console.log("Matched by employeeId:",m,"===",o),!0):i.braiderName&&(a!=null&&a.name)&&i.braiderName===a.name?(console.log("Matched by braiderName:",i.braiderName,"===",a.name),!0):!1});console.log("BraiderProfile - Filtered appointments:",c.length);const N=c.map(i=>({id:i._id,braiderId:i.braiderId,braiderName:i.braiderName,date:i.date,timeSlot:i.timeSlot,customerName:i.customerName,customerEmail:i.customerEmail,customerPhone:i.customerPhone,status:i.status,serviceName:i.serviceName,servicePrice:i.servicePrice})).sort((i,d)=>{const m=i.date.localeCompare(d.date);return m!==0?m:i.timeSlot.localeCompare(d.timeSlot)});j(N)}catch(s){console.error("Error loading bookings:",s);try{const o=M().filter(c=>c.braiderName===(a==null?void 0:a.name)||c.braiderId===E(a==null?void 0:a.name)).sort((c,g)=>{const N=c.date.localeCompare(g.date);return N!==0?N:c.timeSlot.localeCompare(g.timeSlot)});j(o)}catch(n){console.error("Fallback loading failed:",n)}}finally{y(!1)}},E=t=>({Amina:"1",Fatou:"2",Mariama:"3",Aissatou:"4"})[t]||null,A=()=>{const t=new Date().toISOString().split("T")[0];let s=r;l==="upcoming"?s=r.filter(n=>n.date>=t):l==="past"&&(s=r.filter(n=>n.date<t)),w(s)},b=()=>{const t=new Date().toISOString().split("T")[0];return r.filter(s=>s.date>=t).length},S=()=>{const t=new Date().toISOString().split("T")[0];return r.filter(s=>s.date<t||s.status==="completed").length},F=async(t,s)=>{try{await x.updateStatus(t,s),await u(),alert(`Appointment marked as ${s}`)}catch(n){console.error("Error updating status:",n),alert("Failed to update appointment status. Please try again.")}},U=async t=>{try{await x.updateStatus(t,"confirmed"),await u(),alert("Appointment confirmed successfully!")}catch(s){console.error("Error confirming appointment:",s),alert("Failed to confirm appointment. Please try again.")}},C=async t=>{if(window.confirm("Are you sure you want to cancel this appointment?"))try{await x.cancel(t),await u(),alert("Appointment cancelled successfully")}catch(s){console.error("Error cancelling appointment:",s),alert("Failed to cancel appointment. Please try again.")}};return P?e.jsx("div",{className:"braider-profile",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"loading",children:"Loading your appointments..."})})}):e.jsx("div",{className:"braider-profile",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{className:"page-title",children:"Braider Dashboard"}),e.jsxs("p",{className:"welcome-text",children:["Welcome back, ",e.jsx("strong",{children:a==null?void 0:a.name}),"!"]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:r.length}),e.jsx("div",{className:"stat-label",children:"Total Appointments"})]}),e.jsxs("div",{className:"stat-card upcoming-stat",children:[e.jsx("div",{className:"stat-value",children:b()}),e.jsx("div",{className:"stat-label",children:"Upcoming"})]}),e.jsxs("div",{className:"stat-card past-stat",children:[e.jsx("div",{className:"stat-value",children:S()}),e.jsx("div",{className:"stat-label",children:"Completed"})]})]})]}),e.jsxs("div",{className:"filter-tabs",children:[e.jsxs("button",{className:`filter-tab ${l==="all"?"active":""}`,onClick:()=>f("all"),children:["All (",r.length,")"]}),e.jsxs("button",{className:`filter-tab ${l==="upcoming"?"active":""}`,onClick:()=>f("upcoming"),children:["Upcoming (",b(),")"]}),e.jsxs("button",{className:`filter-tab ${l==="past"?"active":""}`,onClick:()=>f("past"),children:["Past (",S(),")"]})]}),v.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“…"}),e.jsx("h2",{children:"No appointments found"}),e.jsx("p",{children:l==="upcoming"?"You don't have any upcoming appointments.":l==="past"?"You don't have any past appointments.":"You don't have any appointments yet."})]}):e.jsx("div",{className:"bookings-list",children:v.map(t=>{const s=t.date>=new Date().toISOString().split("T")[0];return e.jsxs("div",{className:`booking-item ${s?"upcoming":"past"}`,children:[e.jsxs("div",{className:"booking-item-header",children:[e.jsx("div",{className:"booking-status-badge",children:s?"ðŸ“… Upcoming":"âœ… Completed"}),e.jsxs("div",{className:"booking-date-time",children:[e.jsx("span",{className:"date",children:k(t.date)}),e.jsx("span",{className:"time",children:t.timeSlot})]})]}),e.jsxs("div",{className:"booking-client-info",children:[e.jsx("h3",{className:"client-name",children:t.customerName}),e.jsxs("div",{className:"client-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“§"}),e.jsx("span",{className:"detail-text",children:t.customerEmail})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“ž"}),e.jsx("span",{className:"detail-text",children:t.customerPhone})]})]})]}),e.jsxs("div",{className:"booking-service-info",children:[e.jsxs("div",{className:"service-badge",children:[e.jsx("span",{className:"service-icon",children:"âœ¨"}),e.jsx("span",{children:t.serviceName||"Hair Braiding Service"})]}),t.status&&e.jsx("div",{className:`status-badge status-${t.status}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),t.status==="pending"&&e.jsxs("div",{className:"booking-actions",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>U(t.id),children:"Confirm Appointment"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>C(t.id),children:"Cancel"})]}),t.status==="confirmed"&&e.jsxs("div",{className:"booking-actions",children:[e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>F(t.id,"completed"),children:"Mark as Completed"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>C(t.id),children:"Cancel"})]})]},t.id)})})]})})};export{Y as default};
