import{r as d,g as E,i as j,c as P,a as g,j as e,L as u}from"./index-Kok3V0jD.js";import{g as A,d as I}from"./bookingStorage-DA0viRQB.js";import{c as v}from"./timeSlots-qFR2TWJe.js";import{g as y}from"./braiders-zzcBmNph.js";const T=()=>{const[c,m]=d.useState([]),[f,h]=d.useState(!0),[t,b]=d.useState(null),l=E();d.useEffect(()=>{p(),j()&&w()},[]);const w=async()=>{try{const s=await P.getMe();s.reward&&b(s.reward)}catch(s){console.error("Error loading rewards:",s)}},p=async()=>{try{if(!l){h(!1);return}const o=((await g.getAll()).appointments||[]).map(i=>({id:i._id,braiderId:i.braiderId,braiderName:i.braiderName,date:i.date,timeSlot:i.timeSlot,customerName:i.customerName,customerEmail:i.customerEmail,customerPhone:i.customerPhone,status:i.status,serviceName:i.serviceName,servicePrice:i.servicePrice})).sort((i,r)=>{const n=i.date.localeCompare(r.date);return n!==0?n:i.timeSlot.localeCompare(r.timeSlot)});m(o)}catch(s){console.error("Error loading bookings:",s);try{const o=A().filter(i=>i.customerEmail===(l==null?void 0:l.email)).sort((i,r)=>{const n=i.date.localeCompare(r.date);return n!==0?n:i.timeSlot.localeCompare(r.timeSlot)});m(o)}catch(a){console.error("Fallback loading failed:",a)}}finally{h(!1)}},k=async s=>{if(window.confirm("Are you sure you want to cancel this booking?"))try{await g.cancel(s);try{I(s)}catch{}await p(),alert("Booking cancelled successfully.")}catch(a){console.error("Cancel error:",a),alert(a.message||"Error cancelling booking. Please try again.")}},B=()=>{const s=new Date().toISOString().split("T")[0];return c.filter(a=>a.date>=s)},S=()=>{const s=new Date().toISOString().split("T")[0];return c.filter(a=>a.date<s)};if(f)return e.jsx("div",{className:"my-bookings",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"loading",children:"Loading your bookings..."})})});const x=B(),N=S();return e.jsx("div",{className:"my-bookings",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"bookings-header",children:[e.jsx("h1",{className:"page-title",children:"My Bookings"}),e.jsx("p",{className:"page-subtitle",children:"Manage your appointments"}),j()&&t&&e.jsx("div",{className:"rewards-banner",children:e.jsxs("div",{className:"rewards-content",children:[e.jsx("div",{className:"rewards-icon",children:"ðŸŽ"}),e.jsxs("div",{className:"rewards-info",children:[e.jsxs("div",{className:"rewards-points",children:[t.totalPoints||0," Points"]}),e.jsxs("div",{className:"rewards-tier-badge",children:[t.tier||"bronze"," tier"]})]}),t.pointsToNextReward>0&&e.jsx("div",{className:"rewards-progress",children:e.jsxs("p",{children:[t.pointsToNextReward," points until next reward!"]})})]})}),c.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“…"}),e.jsx("h2",{children:"No bookings yet"}),e.jsx("p",{children:"Start by booking your first appointment!"}),e.jsx(u,{to:"/book-appointment",className:"btn btn-primary",children:"Book Appointment"})]})]}),x.length>0&&e.jsxs("section",{className:"bookings-section",children:[e.jsx("h2",{className:"section-heading",children:"Upcoming Appointments"}),e.jsx("div",{className:"bookings-grid",children:x.map(s=>{const a=y(s.braiderId);return e.jsxs("div",{className:"booking-card upcoming",children:[e.jsxs("div",{className:"booking-card-header",children:[e.jsx("div",{className:`booking-status ${s.status==="confirmed"?"upcoming-badge":s.status==="completed"?"past-badge":"cancelled-badge"}`,children:s.status==="confirmed"?"Upcoming":s.status==="completed"?"Completed":s.status==="cancelled"?"Cancelled":s.status}),s.status==="confirmed"&&e.jsx("button",{className:"cancel-button",onClick:()=>k(s.id),"aria-label":"Cancel booking",children:"âœ•"})]}),e.jsxs("div",{className:"booking-content",children:[e.jsxs("div",{className:"booking-braider",children:[e.jsx("span",{className:"braider-emoji",children:(a==null?void 0:a.image)||"ðŸ‘©ðŸ¾"}),e.jsxs("div",{children:[e.jsx("h3",{className:"braider-name",children:s.braiderName}),e.jsx("p",{className:"braider-specialty",children:(a==null?void 0:a.specialty)||"Hair Braiding"})]})]}),e.jsxs("div",{className:"booking-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“…"}),e.jsx("span",{className:"detail-text",children:v(s.date)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"â°"}),e.jsx("span",{className:"detail-text",children:s.timeSlot})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ‘¤"}),e.jsx("span",{className:"detail-text",children:s.customerName})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“§"}),e.jsx("span",{className:"detail-text",children:s.customerEmail})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“ž"}),e.jsx("span",{className:"detail-text",children:s.customerPhone})]})]})]})]},s.id)})})]}),N.length>0&&e.jsxs("section",{className:"bookings-section",children:[e.jsx("h2",{className:"section-heading",children:"Past Appointments"}),e.jsx("div",{className:"bookings-grid",children:N.map(s=>{const a=y(s.braiderId);return e.jsxs("div",{className:"booking-card past",children:[e.jsx("div",{className:"booking-card-header",children:e.jsx("div",{className:"booking-status past-badge",children:"Completed"})}),e.jsxs("div",{className:"booking-content",children:[e.jsxs("div",{className:"booking-braider",children:[e.jsx("span",{className:"braider-emoji",children:(a==null?void 0:a.image)||"ðŸ‘©ðŸ¾"}),e.jsxs("div",{children:[e.jsx("h3",{className:"braider-name",children:s.braiderName}),e.jsx("p",{className:"braider-specialty",children:(a==null?void 0:a.specialty)||"Hair Braiding"})]})]}),e.jsxs("div",{className:"booking-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"ðŸ“…"}),e.jsx("span",{className:"detail-text",children:v(s.date)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-icon",children:"â°"}),e.jsx("span",{className:"detail-text",children:s.timeSlot})]})]})]})]},s.id)})})]}),c.length>0&&e.jsx("div",{className:"book-again-section",children:e.jsx(u,{to:"/book-appointment",className:"btn btn-primary",children:"Book Another Appointment"})})]})})};export{T as default};
