import{r as d,g as E,i as j,c as A,a as g,j as s,L as u}from"./index-ekhgIEl4.js";import{g as I,d as D}from"./bookingStorage-DA0viRQB.js";import{c as v}from"./timeSlots-qFR2TWJe.js";import{g as y}from"./braiders-zzcBmNph.js";import{t as f}from"./toast-6IGnTReI.js";const H=()=>{const[n,m]=d.useState([]),[w,h]=d.useState(!0),[i,B]=d.useState(null),l=E();d.useEffect(()=>{p(),j()&&b()},[]);const b=async()=>{try{const e=await A.getMe();e.reward&&B(e.reward)}catch{}},p=async()=>{try{if(!l){h(!1);return}const o=((await g.getAll()).appointments||[]).map(t=>({id:t._id,braiderId:t.braiderId,braiderName:t.braiderName,date:t.date,timeSlot:t.timeSlot,customerName:t.customerName,customerEmail:t.customerEmail,customerPhone:t.customerPhone,status:t.status,serviceName:t.serviceName,servicePrice:t.servicePrice})).sort((t,r)=>{const c=t.date.localeCompare(r.date);return c!==0?c:t.timeSlot.localeCompare(r.timeSlot)});m(o)}catch{try{const o=I().filter(t=>t.customerEmail===(l==null?void 0:l.email)).sort((t,r)=>{const c=t.date.localeCompare(r.date);return c!==0?c:t.timeSlot.localeCompare(r.timeSlot)});m(o)}catch{}}finally{h(!1)}},k=async e=>{if(window.confirm("Are you sure you want to cancel this booking?"))try{await g.cancel(e);try{D(e)}catch{}await p(),f.success("Booking cancelled successfully.")}catch(a){f.error(a.message||"Error cancelling booking. Please try again.")}},S=()=>{const e=new Date().toISOString().split("T")[0];return n.filter(a=>a.date>=e)},C=()=>{const e=new Date().toISOString().split("T")[0];return n.filter(a=>a.date<e)};if(w)return s.jsx("div",{className:"my-bookings",children:s.jsx("div",{className:"container",children:s.jsx("div",{className:"loading",children:"Loading your bookings..."})})});const x=S(),N=C();return s.jsx("div",{className:"my-bookings",children:s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"bookings-header",children:[s.jsx("h1",{className:"page-title",children:"My Bookings"}),s.jsx("p",{className:"page-subtitle",children:"Manage your appointments"}),j()&&i&&s.jsx("div",{className:"rewards-banner",children:s.jsxs("div",{className:"rewards-content",children:[s.jsx("div",{className:"rewards-icon",children:"ðŸŽ"}),s.jsxs("div",{className:"rewards-info",children:[s.jsxs("div",{className:"rewards-points",children:[i.totalPoints||0," Points"]}),s.jsxs("div",{className:"rewards-tier-badge",children:[i.tier||"bronze"," tier"]})]}),i.pointsToNextReward>0&&s.jsx("div",{className:"rewards-progress",children:s.jsxs("p",{children:[i.pointsToNextReward," points until next reward!"]})})]})}),n.length===0&&s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-icon",children:"ðŸ“…"}),s.jsx("h2",{children:"No bookings yet"}),s.jsx("p",{children:"Start by booking your first appointment!"}),s.jsx(u,{to:"/book-appointment",className:"btn btn-primary",children:"Book Appointment"})]})]}),x.length>0&&s.jsxs("section",{className:"bookings-section",children:[s.jsx("h2",{className:"section-heading",children:"Upcoming Appointments"}),s.jsx("div",{className:"bookings-grid",children:x.map(e=>{const a=y(e.braiderId);return s.jsxs("div",{className:"booking-card upcoming",children:[s.jsxs("div",{className:"booking-card-header",children:[s.jsx("div",{className:`booking-status ${e.status==="confirmed"?"upcoming-badge":e.status==="completed"?"past-badge":"cancelled-badge"}`,children:e.status==="confirmed"?"Upcoming":e.status==="completed"?"Completed":e.status==="cancelled"?"Cancelled":e.status}),e.status==="confirmed"&&s.jsx("button",{className:"cancel-button",onClick:()=>k(e.id),"aria-label":"Cancel booking",children:"âœ•"})]}),s.jsxs("div",{className:"booking-content",children:[s.jsxs("div",{className:"booking-braider",children:[s.jsx("span",{className:"braider-emoji",children:(a==null?void 0:a.image)||"ðŸ‘©ðŸ¾"}),s.jsxs("div",{children:[s.jsx("h3",{className:"braider-name",children:e.braiderName}),s.jsx("p",{className:"braider-specialty",children:(a==null?void 0:a.specialty)||"Hair Braiding"})]})]}),s.jsxs("div",{className:"booking-details",children:[s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-icon",children:"ðŸ“…"}),s.jsx("span",{className:"detail-text",children:v(e.date)})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-icon",children:"â°"}),s.jsx("span",{className:"detail-text",children:e.timeSlot})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-icon",children:"ðŸ‘¤"}),s.jsx("span",{className:"detail-text",children:e.customerName})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-icon",children:"ðŸ“§"}),s.jsx("span",{className:"detail-text",children:e.customerEmail})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-icon",children:"ðŸ“ž"}),s.jsx("span",{className:"detail-text",children:e.customerPhone})]})]})]})]},e.id)})})]}),N.length>0&&s.jsxs("section",{className:"bookings-section",children:[s.jsx("h2",{className:"section-heading",children:"Past Appointments"}),s.jsx("div",{className:"bookings-grid",children:N.map(e=>{const a=y(e.braiderId);return s.jsxs("div",{className:"booking-card past",children:[s.jsx("div",{className:"booking-card-header",children:s.jsx("div",{className:"booking-status past-badge",children:"Completed"})}),s.jsxs("div",{className:"booking-content",children:[s.jsxs("div",{className:"booking-braider",children:[s.jsx("span",{className:"braider-emoji",children:(a==null?void 0:a.image)||"ðŸ‘©ðŸ¾"}),s.jsxs("div",{children:[s.jsx("h3",{className:"braider-name",children:e.braiderName}),s.jsx("p",{className:"braider-specialty",children:(a==null?void 0:a.specialty)||"Hair Braiding"})]})]}),s.jsxs("div",{className:"booking-details",children:[s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-icon",children:"ðŸ“…"}),s.jsx("span",{className:"detail-text",children:v(e.date)})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-icon",children:"â°"}),s.jsx("span",{className:"detail-text",children:e.timeSlot})]})]})]})]},e.id)})})]}),n.length>0&&s.jsx("div",{className:"book-again-section",children:s.jsx(u,{to:"/book-appointment",className:"btn btn-primary",children:"Book Another Appointment"})})]})})};export{H as default};
