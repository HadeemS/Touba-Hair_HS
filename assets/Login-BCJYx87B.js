import{u as N,f as R,r as i,j as e,h as u,g as E,e as y,k as A,l as P}from"./index-D81LPs97.js";import{t as g}from"./toast-6IGnTReI.js";const T=()=>{var w,j;const a=N(),v=R(),[d,k]=i.useState({emailOrUsername:"",password:""}),[h,n]=i.useState(""),[x,f]=i.useState(!1),[c,S]=i.useState(!1),[o,p]=i.useState("checking"),l=((j=(w=v.state)==null?void 0:w.from)==null?void 0:j.pathname)||"/";i.useEffect(()=>{const s=()=>{E()&&(u()?a("/admin",{replace:!0}):y()?a("/braider-profile",{replace:!0}):a(l==="/login"?"/my-bookings":l,{replace:!0}))};s();const r=()=>{s()};return window.addEventListener("auth-changed",r),()=>{window.removeEventListener("auth-changed",r)}},[a,l]);const m=async()=>{var s;p("checking"),n("");try{const r=await A();r.status==="ok"&&((s=r.database)!=null&&s.isConnected)?(p("online"),n("")):(p("degraded"),n("Server is starting up. Please wait a moment and try again."))}catch{p("offline"),n("Cannot connect to server. The backend may be starting up. Please wait a moment.")}};i.useEffect(()=>{m()},[]);const b=s=>{k({...d,[s.target.name]:s.target.value}),n("")},C=async s=>{s.preventDefault(),n(""),f(!0);try{const r=await P(d.emailOrUsername,d.password);if(r.success){if(g.success("Login successful!"),r.requiresPasswordChange){a("/change-password",{replace:!0,state:{forced:!0}});return}requestAnimationFrame(()=>{u()?a("/admin",{replace:!0}):y()?a("/braider-profile",{replace:!0}):a(l==="/login"?"/my-bookings":l,{replace:!0})})}else{const t=r.error||"Invalid email or password";g.error(t),n(t)}}catch(r){const t=r.message||"An error occurred. Please try again.";g.error(t),n(t)}finally{f(!1)}};return e.jsx("div",{className:"login-page",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"login-card",children:[e.jsxs("div",{className:"login-header",children:[e.jsx("h1",{className:"login-title",children:"Welcome Back"}),e.jsx("p",{className:"login-subtitle",children:"Sign in to access your account"})]}),o==="offline"&&e.jsx("div",{className:"error-message",style:{backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffc107",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"10px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"âš ï¸ Server is offline"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9em"},children:"The backend may be starting up. Free Render services sleep after 15 minutes of inactivity and take 30-60 seconds to wake up."})]}),e.jsx("button",{type:"button",onClick:m,style:{padding:"8px 16px",backgroundColor:"#ffc107",color:"#856404",border:"1px solid #ffc107",borderRadius:"4px",cursor:"pointer",fontWeight:"bold",whiteSpace:"nowrap"},children:o==="checking"?"Checking...":"Check Server"})]})}),o==="degraded"&&e.jsx("div",{className:"error-message",style:{backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffc107",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"10px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"âš ï¸ Database is connecting"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9em"},children:"Please wait a moment and try again."})]}),e.jsx("button",{type:"button",onClick:m,style:{padding:"8px 16px",backgroundColor:"#ffc107",color:"#856404",border:"1px solid #ffc107",borderRadius:"4px",cursor:"pointer",fontWeight:"bold",whiteSpace:"nowrap"},children:o==="checking"?"Checking...":"Refresh"})]})}),o==="checking"&&e.jsx("div",{className:"error-message",style:{backgroundColor:"#d1ecf1",color:"#0c5460",border:"1px solid #bee5eb",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:"ðŸ”„ Checking server status..."}),o==="online"&&e.jsx("div",{className:"error-message",style:{backgroundColor:"#d4edda",color:"#155724",border:"1px solid #c3e6cb",padding:"10px 15px",borderRadius:"8px",marginBottom:"15px",fontSize:"0.9em"},children:"âœ… Server is online and ready"}),h&&o==="online"&&e.jsx("div",{className:"error-message",children:h}),e.jsxs("form",{onSubmit:C,className:"login-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"emailOrUsername",children:"Email or Username"}),e.jsx("input",{type:"text",id:"emailOrUsername",name:"emailOrUsername",value:d.emailOrUsername,onChange:b,required:!0,placeholder:"your.email@example.com or username",autoComplete:"username"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:c?"text":"password",id:"password",name:"password",value:d.password,onChange:b,required:!0,placeholder:"Enter your password",autoComplete:"current-password",className:"password-input"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>S(!c),"aria-label":c?"Hide password":"Show password",title:c?"Hide password":"Show password",children:c?e.jsx("span",{className:"password-icon","aria-hidden":"true",children:"Hide"}):e.jsx("span",{className:"password-icon","aria-hidden":"true",children:"Show"})})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-large",disabled:x,children:x?"Signing in...":"Sign In"})]}),u()&&e.jsxs("div",{className:"login-admin-section",style:{marginTop:"20px",padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6"},children:[e.jsx("h3",{style:{fontSize:"14px",marginBottom:"10px",color:"#6c757d"},children:"Admin Access"}),e.jsx("p",{style:{fontSize:"12px",color:"#6c757d",margin:0},children:"You are logged in as an administrator."})]}),e.jsxs("div",{className:"login-footer",children:[e.jsxs("p",{children:["Don't have an account? ",e.jsx("a",{href:"/register",children:"Sign up here"})]}),e.jsxs("p",{children:["Are you a braider? ",e.jsx("a",{href:"/braider-register",children:"Create braider account"})]})]})]})})})};export{T as default};
