import{r as n,g as T,i as R,b as P,c as _,d as q,j as e,L as B}from"./index-Df9NR534.js";import{g as F,s as J}from"./profileStorage-CD0cgD4v.js";const $=()=>{const[t,f]=n.useState({name:"",email:"",phone:"",notes:""}),[N,h]=n.useState(""),[l,k]=n.useState(null),[O,y]=n.useState(!1),[w,b]=n.useState(!1),[r,d]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[j,i]=n.useState(""),[v,C]=n.useState(!1),[m,E]=n.useState(!1),[p,M]=n.useState(!1),[u,I]=n.useState(!1);n.useEffect(()=>{const s=F();s&&f(s),T()&&(L(),R()&&A())},[]);const L=async()=>{try{const s=await P.getMe();s.user&&f({name:s.user.name||"",email:s.user.email||"",phone:s.user.phone||"",notes:s.user.notes||""})}catch(s){console.error("Error loading profile:",s)}},A=async()=>{try{y(!0);const s=await _.getMe();s.reward&&k(s.reward)}catch(s){console.error("Error loading rewards:",s)}finally{y(!1)}},g=s=>{const{name:o,value:x}=s.target;f(c=>({...c,[o]:x}))},D=async s=>{s.preventDefault();try{const o=await P.updateProfile({name:t.name,email:t.email,phone:t.phone,notes:t.notes});if(o.user){const x=localStorage.getItem("touba_hair_auth");if(x){const c=JSON.parse(x);c.email=o.user.email,c.name=o.user.name,localStorage.setItem("touba_hair_auth",JSON.stringify(c))}}J(t),h("Profile saved successfully!"),setTimeout(()=>h(""),3e3)}catch(o){console.error("Error saving profile:",o),h(o.message||"Error saving profile. Please try again."),setTimeout(()=>h(""),3e3)}},H=async s=>{if(s.preventDefault(),i(""),r.newPassword.length<6){i("Password must be at least 6 characters.");return}if(r.newPassword!==r.confirmPassword){i("New passwords do not match.");return}if(((a==null?void 0:a.role)==="employee"||(a==null?void 0:a.role)==="admin")&&!r.currentPassword){i("Current password is required.");return}C(!0);try{await P.changePassword({currentPassword:r.currentPassword||void 0,newPassword:r.newPassword}),i("Password changed successfully!"),d({currentPassword:"",newPassword:"",confirmPassword:""}),b(!1),setTimeout(()=>i(""),3e3)}catch(o){console.error("Error changing password:",o),i(o.message||"Failed to change password. Please try again.")}finally{C(!1)}},a=T(),S=q();return e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"My Profile"}),e.jsx("p",{children:S?`Welcome, ${a==null?void 0:a.name}! Manage your braider profile.`:"Save your info so booking is faster next time."}),S&&e.jsx(B,{to:"/braider-profile",className:"btn btn-secondary",style:{marginTop:"1rem"},children:"View My Appointments"})]}),R()&&l&&e.jsxs("section",{className:"booking-card",style:{marginTop:"1.25rem"},children:[e.jsx("h2",{style:{marginBottom:"1rem"},children:"ğŸ Your Rewards"}),e.jsxs("div",{className:"rewards-display",children:[e.jsxs("div",{className:"rewards-stat",children:[e.jsx("div",{className:"rewards-value",children:l.totalPoints||0}),e.jsx("div",{className:"rewards-label",children:"Total Points"})]}),e.jsxs("div",{className:"rewards-stat",children:[e.jsx("div",{className:"rewards-tier",children:l.tier||"bronze"}),e.jsx("div",{className:"rewards-label",children:"Current Tier"})]}),l.pointsToNextReward>0&&e.jsxs("div",{className:"rewards-next",children:[e.jsxs("p",{children:["ğŸ¯ ",l.pointsToNextReward," points until your next reward!"]}),l.nextRewardThreshold&&e.jsxs("p",{className:"rewards-threshold",children:["Next reward: ",l.nextRewardThreshold.reward," at ",l.nextRewardThreshold.points," points"]})]})]})]}),e.jsxs("section",{className:"booking-card",style:{marginTop:"1.25rem"},children:[N&&e.jsx("div",{className:"alert",children:N}),e.jsxs("form",{onSubmit:D,className:"form-grid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Full Name"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:g})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:g,placeholder:"your.email@example.com"}),e.jsx("small",{className:"field-hint",children:"You can change your email address"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:t.phone,onChange:g})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Notes / Hair Info"}),e.jsx("textarea",{rows:"3",name:"notes",value:t.notes,onChange:g,placeholder:"Preferred styles, hair length, sensitivities, etc."})]}),e.jsx("div",{className:"booking-actions",children:e.jsx("button",{type:"submit",className:"btn-primary",children:"Save Profile"})})]})]}),e.jsxs("section",{className:"booking-card",style:{marginTop:"1.25rem"},children:[e.jsxs("div",{className:"password-change-header",children:[e.jsx("h2",{children:"ğŸ”’ Change Password"}),e.jsx("button",{type:"button",className:"btn-toggle",onClick:()=>{b(!w),i(""),w||d({currentPassword:"",newPassword:"",confirmPassword:""})},children:w?"Cancel":"Change Password"})]}),w&&e.jsxs("form",{onSubmit:H,className:"password-change-form",children:[j&&e.jsx("div",{className:`password-message ${j.includes("successfully")?"success":"error"}`,children:j}),e.jsxs("label",{className:"field",children:[e.jsxs("span",{children:["Current Password ",(a==null?void 0:a.role)==="employee"||(a==null?void 0:a.role)==="admin"?"*":"(if you have one)"]}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:m?"text":"password",value:r.currentPassword,onChange:s=>d({...r,currentPassword:s.target.value}),placeholder:(a==null?void 0:a.role)==="client"?"Leave empty if you don't have a password":"Enter your current password",className:"password-input"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>E(!m),"aria-label":m?"Hide password":"Show password",children:m?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]}),(a==null?void 0:a.role)==="client"&&e.jsx("small",{className:"field-hint",children:"If you don't have a password yet, leave this empty to set one"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"New Password *"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:p?"text":"password",value:r.newPassword,onChange:s=>d({...r,newPassword:s.target.value}),required:!0,minLength:6,placeholder:"At least 6 characters",className:"password-input"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>M(!p),"aria-label":p?"Hide password":"Show password",children:p?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]}),e.jsx("small",{className:"field-hint",children:"Must be at least 6 characters"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Confirm New Password *"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:u?"text":"password",value:r.confirmPassword,onChange:s=>d({...r,confirmPassword:s.target.value}),required:!0,minLength:6,placeholder:"Re-enter your new password",className:"password-input"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>I(!u),"aria-label":u?"Hide password":"Show password",children:u?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]})]}),e.jsx("div",{className:"booking-actions",children:e.jsx("button",{type:"submit",className:"btn-primary",disabled:v,children:v?"Changing Password...":"Change Password"})})]})]})]})})};export{$ as default};
