import{r as t,g as M,i as R,b as y,c as q,d as B,j as e,L as F}from"./index-end0shK6.js";import{g as J,s as O}from"./profileStorage-CD0cgD4v.js";import{t as x}from"./toast-6IGnTReI.js";const V=()=>{const[l,P]=t.useState({name:"",email:"",phone:"",notes:""}),[N,m]=t.useState(""),[i,k]=t.useState(null),[U,b]=t.useState(!1),[w,v]=t.useState(!1),[r,c]=t.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[j,d]=t.useState(""),[C,S]=t.useState(!1),[u,E]=t.useState(!1),[p,I]=t.useState(!1),[g,L]=t.useState(!1);t.useEffect(()=>{const s=J();s&&P(s),M()&&(A(),R()&&D())},[]);const A=async()=>{try{const s=await y.getMe();s.user&&P({name:s.user.name||"",email:s.user.email||"",phone:s.user.phone||"",notes:s.user.notes||""})}catch{}},D=async()=>{try{b(!0);const s=await q.getMe();s.reward&&k(s.reward)}catch{}finally{b(!1)}},f=s=>{const{name:n,value:o}=s.target;P(h=>({...h,[n]:o}))},H=async s=>{s.preventDefault();try{const n=await y.updateProfile({name:l.name,email:l.email,phone:l.phone,notes:l.notes});if(n.user){const o=localStorage.getItem("touba_hair_auth");if(o){const h=JSON.parse(o);h.email=n.user.email,h.name=n.user.name,localStorage.setItem("touba_hair_auth",JSON.stringify(h))}}O(l),m("Profile saved successfully!"),x.success("Profile saved successfully!"),setTimeout(()=>m(""),3e3)}catch(n){const o=n.message||"Error saving profile. Please try again.";m(o),x.error(o),setTimeout(()=>m(""),3e3)}},_=async s=>{if(s.preventDefault(),d(""),r.newPassword.length<6){d("Password must be at least 6 characters.");return}if(r.newPassword!==r.confirmPassword){d("New passwords do not match.");return}if(((a==null?void 0:a.role)==="employee"||(a==null?void 0:a.role)==="admin")&&!r.currentPassword){d("Current password is required.");return}S(!0);try{await y.changePassword({currentPassword:r.currentPassword||void 0,newPassword:r.newPassword}),d("Password changed successfully!"),x.success("Password changed successfully!"),c({currentPassword:"",newPassword:"",confirmPassword:""}),v(!1),setTimeout(()=>d(""),3e3)}catch(n){const o=n.message||"Failed to change password. Please try again.";d(o),x.error(o)}finally{S(!1)}},a=M(),T=B();return e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container",children:[e.jsxs("header",{className:"page-header",children:[e.jsx("h1",{children:"My Profile"}),e.jsx("p",{children:T?`Welcome, ${a==null?void 0:a.name}! Manage your braider profile.`:"Save your info so booking is faster next time."}),T&&e.jsx(F,{to:"/braider-profile",className:"btn btn-secondary",style:{marginTop:"1rem"},children:"View My Appointments"})]}),R()&&i&&e.jsxs("section",{className:"booking-card",style:{marginTop:"1.25rem"},children:[e.jsx("h2",{style:{marginBottom:"1rem"},children:"ğŸ Your Rewards"}),e.jsxs("div",{className:"rewards-display",children:[e.jsxs("div",{className:"rewards-stat",children:[e.jsx("div",{className:"rewards-value",children:i.totalPoints||0}),e.jsx("div",{className:"rewards-label",children:"Total Points"})]}),e.jsxs("div",{className:"rewards-stat",children:[e.jsx("div",{className:"rewards-tier",children:i.tier||"bronze"}),e.jsx("div",{className:"rewards-label",children:"Current Tier"})]}),i.pointsToNextReward>0&&e.jsxs("div",{className:"rewards-next",children:[e.jsxs("p",{children:["ğŸ¯ ",i.pointsToNextReward," points until your next reward!"]}),i.nextRewardThreshold&&e.jsxs("p",{className:"rewards-threshold",children:["Next reward: ",i.nextRewardThreshold.reward," at ",i.nextRewardThreshold.points," points"]})]})]})]}),e.jsxs("section",{className:"booking-card",style:{marginTop:"1.25rem"},children:[N&&e.jsx("div",{className:"alert",children:N}),e.jsxs("form",{onSubmit:H,className:"form-grid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Full Name"}),e.jsx("input",{type:"text",name:"name",value:l.name,onChange:f})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",name:"email",value:l.email,onChange:f,placeholder:"your.email@example.com"}),e.jsx("small",{className:"field-hint",children:"You can change your email address"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:l.phone,onChange:f})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Notes / Hair Info"}),e.jsx("textarea",{rows:"3",name:"notes",value:l.notes,onChange:f,placeholder:"Preferred styles, hair length, sensitivities, etc."})]}),e.jsx("div",{className:"booking-actions",children:e.jsx("button",{type:"submit",className:"btn-primary",children:"Save Profile"})})]})]}),e.jsxs("section",{className:"booking-card",style:{marginTop:"1.25rem"},children:[e.jsxs("div",{className:"password-change-header",children:[e.jsx("h2",{children:"ğŸ”’ Change Password"}),e.jsx("button",{type:"button",className:"btn-toggle",onClick:()=>{v(!w),d(""),w||c({currentPassword:"",newPassword:"",confirmPassword:""})},children:w?"Cancel":"Change Password"})]}),w&&e.jsxs("form",{onSubmit:_,className:"password-change-form",children:[j&&e.jsx("div",{className:`password-message ${j.includes("successfully")?"success":"error"}`,children:j}),e.jsxs("label",{className:"field",children:[e.jsxs("span",{children:["Current Password ",(a==null?void 0:a.role)==="employee"||(a==null?void 0:a.role)==="admin"?"*":"(if you have one)"]}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:u?"text":"password",value:r.currentPassword,onChange:s=>c({...r,currentPassword:s.target.value}),placeholder:(a==null?void 0:a.role)==="client"?"Leave empty if you don't have a password":"Enter your current password",className:"password-input"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>E(!u),"aria-label":u?"Hide password":"Show password",children:u?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]}),(a==null?void 0:a.role)==="client"&&e.jsx("small",{className:"field-hint",children:"If you don't have a password yet, leave this empty to set one"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"New Password *"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:p?"text":"password",value:r.newPassword,onChange:s=>c({...r,newPassword:s.target.value}),required:!0,minLength:6,placeholder:"At least 6 characters",className:"password-input"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>I(!p),"aria-label":p?"Hide password":"Show password",children:p?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]}),e.jsx("small",{className:"field-hint",children:"Must be at least 6 characters"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{children:"Confirm New Password *"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:g?"text":"password",value:r.confirmPassword,onChange:s=>c({...r,confirmPassword:s.target.value}),required:!0,minLength:6,placeholder:"Re-enter your new password",className:"password-input"}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>L(!g),"aria-label":g?"Hide password":"Show password",children:g?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]})]}),e.jsx("div",{className:"booking-actions",children:e.jsx("button",{type:"submit",className:"btn-primary",disabled:C,children:C?"Changing Password...":"Change Password"})})]})]})]})})};export{V as default};
