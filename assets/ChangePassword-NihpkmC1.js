import{u as F,f as H,r as o,g as x,j as s,c as b}from"./index-BBc8ulUK.js";import{t as N}from"./toast-6IGnTReI.js";const U=()=>{const t=F(),h=H(),[r,j]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[f,n]=o.useState(""),[g,P]=o.useState(!1),[l,C]=o.useState(!1),[w,y]=o.useState(!1),[u,v]=o.useState(!1),[d,S]=o.useState(!1);o.useEffect(()=>{var i;const a=x();if(!a){t("/login",{replace:!0});return}const c=((i=h.state)==null?void 0:i.forced)||a.forcePasswordChange;S(c),c||(async()=>{try{const e=await b.getMe();(!e.user||!e.user.forcePasswordChange)&&t("/my-bookings",{replace:!0})}catch{}})()},[t,h]);const m=a=>{j({...r,[a.target.name]:a.target.value}),n("")},k=a=>a.length<10?"Password must be at least 10 characters":/^(?=.*[a-zA-Z])(?=.*\d)/.test(a)?null:"Password must contain at least one letter and one number",E=async a=>{var i;a.preventDefault(),n("");const c=k(r.newPassword);if(c){n(c);return}if(r.newPassword!==r.confirmPassword){n("New passwords do not match");return}if(!d&&!r.currentPassword){n("Current password is required");return}P(!0);try{if((await b.changePassword({currentPassword:r.currentPassword||void 0,newPassword:r.newPassword,confirmPassword:r.confirmPassword})).message){N.success("Password changed successfully!");const e=x();e&&(e.forcePasswordChange=!1,localStorage.setItem("touba_hair_auth",JSON.stringify(e))),setTimeout(()=>{(e==null?void 0:e.role)==="admin"?t("/admin",{replace:!0}):(e==null?void 0:e.role)==="employee"?t("/braider-profile",{replace:!0}):t("/my-bookings",{replace:!0})},1e3)}}catch(p){const e=((i=p.response)==null?void 0:i.error)||p.message||"Failed to change password. Please try again.";n(e),N.error(e)}finally{P(!1)}};return s.jsx("div",{className:"change-password-page",children:s.jsx("div",{className:"container",children:s.jsxs("div",{className:"change-password-card",children:[s.jsxs("div",{className:"change-password-header",children:[s.jsx("h1",{className:"change-password-title",children:d?"Change Your Password":"Update Password"}),d&&s.jsx("p",{className:"change-password-subtitle",children:"You must change your password before continuing."})]}),f&&s.jsx("div",{className:"error-message",children:f}),s.jsxs("form",{onSubmit:E,className:"change-password-form",children:[!d&&s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"currentPassword",children:"Current Password"}),s.jsxs("div",{className:"password-input-wrapper",children:[s.jsx("input",{type:l?"text":"password",id:"currentPassword",name:"currentPassword",value:r.currentPassword,onChange:m,required:!d,placeholder:"Enter your current password",autoComplete:"current-password",className:"password-input"}),s.jsx("button",{type:"button",className:"password-toggle",onClick:()=>C(!l),"aria-label":l?"Hide password":"Show password",children:l?"Hide":"Show"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"newPassword",children:"New Password"}),s.jsxs("div",{className:"password-input-wrapper",children:[s.jsx("input",{type:w?"text":"password",id:"newPassword",name:"newPassword",value:r.newPassword,onChange:m,required:!0,placeholder:"Enter new password (min 10 characters)",autoComplete:"new-password",className:"password-input"}),s.jsx("button",{type:"button",className:"password-toggle",onClick:()=>y(!w),"aria-label":w?"Hide password":"Show password",children:w?"Hide":"Show"})]}),s.jsx("small",{className:"form-help",children:"Must be at least 10 characters and contain at least one letter and one number"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),s.jsxs("div",{className:"password-input-wrapper",children:[s.jsx("input",{type:u?"text":"password",id:"confirmPassword",name:"confirmPassword",value:r.confirmPassword,onChange:m,required:!0,placeholder:"Confirm new password",autoComplete:"new-password",className:"password-input"}),s.jsx("button",{type:"button",className:"password-toggle",onClick:()=>v(!u),"aria-label":u?"Hide password":"Show password",children:u?"Hide":"Show"})]})]}),s.jsx("button",{type:"submit",className:"btn btn-primary btn-large",disabled:g,children:g?"Changing Password...":"Change Password"})]})]})})})};export{U as default};
